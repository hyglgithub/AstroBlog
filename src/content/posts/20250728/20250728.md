---
title: ​Java中String的到底存在哪里？？？
description: 这篇文章专门聊 Java 里 String 是怎么存的。我们会讲到堆和字符串常量池的区别，字面量和 new 出来的字符串在内存里的不同去处，还会顺带回答一个常见的面试问题：到底创建了几个对象？最后再看看 String.intern() 是怎么影响常量池的，让你对字符串的内存分配和优化有个清晰的认识。
published: 2025-07-28
tags: [java, String, 堆，字符串常量池]
category: 原创
draft: false
---

一、堆与字符串常量池
堆是 Java 虚拟机中存储对象实例和数组的内存区域。
字符串常量池（String Pool）是 JVM 专门为字符串字面量分配的区域，用于存放所有用双引号声明的字符串常量，以及运行时调用 `intern()` 方法生成的字符串。常量池中的相同内容只保存一份，多个引用会指向同一个对象，从而节省内存并提升效率。

![在这里插入图片描述](./image.png)

字符串池能够成立的前提是 **String 对象不可变**，这样多个引用共享同一对象才不会互相影响；若可变，则一个引用修改会影响所有引用，显然不可行。

二、Java 创建字符串对象的两种方式

1. **字面值方式**

```java
String str1 = "aaa";
String str2 = "aaa";
System.out.println(str1 == str2); // true
```

字面量创建时，JVM 会先查常量池：不存在则创建，存在则直接返回引用。`str1` 和 `str2` 指向同一个常量池对象，因此 `==` 为 `true`。

2. **new 关键字方式**

```java
String str1 = new String("aaa");
String str2 = new String("aaa");
System.out.println(str1 == str2); // false
```

`new String("aaa")` 时，若常量池无 `"aaa"` 会先创建，然后**无论是否存在**，都会在堆中新建一个 `"aaa"` 对象并返回其引用。每次 `new` 都会产生新的堆对象，因此 `==` 为 `false`。

三、经典面试题：创建了几个对象？

1. `String s1 = "11";` → 1 个（常量池）。
2. `String s1 = "1" + "1";` → 编译期优化成 `"11"`，1 个（常量池）。
3. `String s1 = new String("11");` → 常量池 1 个 + 堆 1 个 = 2 个。
4. `String s1 = new String("1") + new String("1");` → 常量池 `"1"` 1 个 + 堆 `"1"` 2 个 + 堆 `"11"` 1 个 = 4 个。

四、`String.intern()` 的作用

* **常量池已存在**：返回常量池中已有的引用，不加入当前对象。

```java
String a = "abc";
String b = new String("abc");
System.out.println(b.intern() == a); // true
```

* **常量池不存在**：将当前字符串引用放入常量池，并返回该引用。

```java
String s1 = new String("x") + new String("y");
System.out.println(s1.intern() == s1); // true
```

这里 `"xy"` 不在常量池中，`intern()` 将 `s1` 放入池中并返回自身引用。
